<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Create - Brainsprint</title>
        <meta charset="utf-8"/>
        <link rel="stylesheet" href="../css/brain_style.css">
        <link rel="stylesheet" href="../css/create_style.css">
        <link rel="icon" href="../images/brain.png">
        <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
        <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
        <script type="text/javascript" src="../js/setup-firebase.js"></script>
        <script src="../js/jquery-3.3.1.js"></script>
    </head>
    <body>
      <div class="pagewrap">
        <div id="div_head">

          <div id="div_logo_bar">

            <div id="div_logo">
              <a href="dashboard.html"><img src="../images/brain.png" alt="brain_logo" id="brain_logo"></a>
              <h1 id="brain_name">BrainSprint</h1>
              <img src="../images/profile_icon.png" alt="profile_icon" id="profile_icon">
            </div>

            <div class="div_profile">

            </div>

          </div>

          <div id="div_nav_bar">
            <a id="nav_dashboard" class="nav_options" href="dashboard.html">Dashboard</a>
            <a id="nav_logout" class="nav_options"  href="homepage.html">Log Out</a>
            <a id="nav_help" class="nav_options"  href="help.html">Help </a>
          </div>
        </div>

        <div id='div_create'>
          <div id="div_pagename">
            <h1 id="pagename">Create a Room</h1>
          </div>
          <div id='div_form'>
            <form class="create_form" id="create_room_form">
              <fieldset class="title_form">
                <input type="text" id="room_name" name="name" placeholder="Room Name" required="required">
                <!-- <span class="tooltip"><abbr title="The name of the room that you will create">?</abbr></span> -->
                <div class="tooltip">?
                  <span class="tooltiptext">The name of the room that you will create</span>
                </div>
              </fieldset>

              <br>

              <fieldset class="topic" id="topic_fieldset">
                <input type="text" name="topic1" placeholder="Topic Title" required="required" class="topic_name">
                <!-- <span class="tooltip"><abbr title="A topic that you will be brainstorming on">?</abbr></span> -->
                <div class="tooltip">?
                  <span class="tooltiptext">A topic that you will be brainstorming on</span>
                </div>

                <br>
                <label id="time_select_label">Topic Duration:</label>
                <select size="1" name="time" id="time" class="time_select">
                  <option value="30" selected="selected">30 seconds</option>
                  <option value="60">1 minute</option>
                  <option value="120">2 minutes</option>
                  <option value="180">3 minutes</option>
                  <option value="240">4 minutes</option>
                  <option value="320">5 minutes</option>
                </select>
                <!-- <span class="tooltip"><abbr title="The amount of time that brain sprinters can reply to a topic">?</abbr></span> -->
                <div class="tooltip">?
                  <span class="tooltiptext">The amount of time that brain sprinters can reply to a topic</span>
                </div>

                <!-- <span class="tooltip" id="trash_tool"><abbr title="This button deletes this topic">?</abbr></span> -->
                <div class="tooltip" id="trash_tool">?
                  <span class="tooltiptext">This button deletes this topic</span>
                </div>
                <input type="button" id="delete1" onclick="deletePrompt(event)" name="delete1" value="Trash" class="trash_button"/>

              </fieldset>
              <br>
              <input type="button" id="create_prompt_button" onclick="createPrompt()" name="new" value="Add more topics" class="create_input">
              <!-- <span class="tooltip"><abbr title="The amount of time that brain sprinters can reply to a topic">?</abbr></span> -->
              <div class="tooltip">?
                <span class="tooltiptext">The amount of time that brain sprinters can reply to a topic</span>
              </div>

              <input type="button" onclick="resetFields()" id="reset_button" name="reset_button" value="Reset" class="button_final"/>
              <!-- <span class="tooltip"><abbr title="This button clears all of the information you have added in the area above">?</abbr></span> -->
              <div class="tooltip">?
                <span class="tooltiptext">This button clears all of the information you have added in the area above</span>
              </div>

              <input type="button" onclick="createActivity()" id="create" name="create" value="Create" class="button_final"/>
              <!-- <span class="tooltip"><abbr title="This button saves the information you have put in and creates your room">?</abbr></span> -->
              <div class="tooltip">?
                <span class="tooltiptext">This button saves the information you have put in and creates your room</span>
              </div>

            </form>
          </div>
        </div>
        <div class="bottom">
          <div class="bottom_bar">

          </div>
        </div>
      </div>

      <script>
          /*<![CDATA[*/
          // var trashButtons = document.getElementsByClassName('topic');
          // trashButtons.onclick = function() {

          // };

          /**Resets the form.**/
          function resetFields() {
            var form = document.getElementById("create_room_form").reset();
          }
          
          /**Adds a new input area for adding a new prompt.**/
          function createPrompt() {
            var newTopic = document.getElementById("topic_fieldset");
            var clone = newTopic.cloneNode(true);
            $(clone).css("margin-bottom", "2em");
            var cloneC = clone.children;
            cloneC[0].value = "";
            cloneC[3].value = 30;
            $(cloneC[6]).css("visibility", "visible");
            $(cloneC[7]).css("visibility", "visible");
            document.getElementById("create_prompt_button").before(clone);

          }
          
          /**Deletes the topic which this button was clicked from. **/
          function deletePrompt(event) {
            var trigger = event.target;
            console.log(trigger.parentNode);
            trigger.parentNode.remove();
          }

          /**Processes the information in the form and saves it in database.**/
          function createActivity() {
            var roomName = document.getElementById("room_name");
            var topicNames = document.getElementsByClassName("topic_name");
            var topicTimes = document.getElementsByClassName("time_select");
            var prompts = {};
            for (let i = 0; i < topicNames.length; i++) {
              prompts[topicNames[i].value] = {
                topicTimes: topicTimes[i].value
              };
            }
              
            console.log(topicNames);
            console.log(topicTimes);
            console.log(prompts);
            console.log(JSON.stringify(prompts));
            /**
            var prompts = [];
            $(".topic").each(function() {
              prompts += {
                topic: $(this).find(".topic_name").val(),
                time : $(this).find(".time_select").val()
            };
            });
            **/
            // A post entry.
            var postData = {
              title: roomName.value,
              prompts: prompts
            };

            database.ref().child('roomList').push().set(postData);
            
            console.log("updated database!");
            console.log(prompts);
      
            // Write the new post's data simultaneously in the posts list and the user's post list.
            /**var updates = {};
            updates['/roomList/' + newPostKey] = postData;

            return firebase.database().ref().update(updates); **/
          }
        /*]]>*/
      </script>
    </body>
</html>
